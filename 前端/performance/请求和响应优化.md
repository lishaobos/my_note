# 请求和响应优化

核心思路：

- 更快的连接传输效率

- 更小的请求资源

- 合适的缓存策略

最佳实践：

- 减少 DNS 查找：每次主机名的解析都需要一次网络往返，从而增加了请求的延迟时间，同时还会阻塞后续的请求。

- 重用 TCP 连接：尽可能的使用持久连接，以消除因 TCP 握手和慢启动导致的延迟。

- 减少 HTTP 重定向：HTTP 冲定向需要额外的 DNS 查询、TCP 握手等非常耗时，最佳的重定向次数为0。

- 压缩传输的资源：比如 Gzip、图片压缩。

- 使用缓存：比如 HTTP 缓存、CDN 缓存、Service Worker 缓存。

- 使用 CDN（内容分发网络）：把数据放在离用户地理位置更近的地方，可以明显减少每次 TCP 连接的网络延迟，增大吞吐量。

- 删除没有必要请求的资源。

- 在客户端缓存资源：缓存必要的应用资源，避免每次都重复请求相同的内容，例如多图片下载可以考虑使用缓存。

- 内容在传输前先压缩：传输数据之前应该先压缩应用资源，把要传输的字节减少到最小，在压缩的时候确保对每种不同的资源采用最好的压缩手段。

- 消除不必要的请求开销：减少请求的 HTTP 首部数据（比如 HTTP COokie）

- 并行处理请求和响应：请求和响应的排队都会导致延迟，可以尝试并行的处理请求和响应（利用多个 HTTP1.1 连接实现并行下载，在可能的情况下使用 HTTP 管道计数）。

- 针对协议版本采取优化措施。升级到 HTTP2.0。

- 根据需要采用服务端渲染方式。这种方式可以解决 SPA 应用首屏渲染慢的问题。

- 采用预渲染的方式快速加载静态页面。页面渲染的极致性能，比较适合静态页面。

## DNS 解析

当网站请求第三方地址的时候需要把域名转化为 IP 地址，然后去请求资源，这个过程就叫做 DNS 解析，如果没有缓存 DNS 结果的话，这个过程大概得 20 - 120ms，如果有很多第三方资源的请求，那么这个时间加起来就很长了

解决办法：

- 1.在 head 处加上第三方的域名的提前解析
    ```
    // 注意点
    // 1.dns-prefetch 仅对跨域的资源有效
    // 2.重复使用会增加重复的 DNS 查询次数
    // 3.DNS 解析请求会耗费流量
    // 4.
    <link rel='dns-prefetch' href='xxx' />
    ```

---

## HTTP 版本

### HTTP 1.1

- 该版本较之前增加了 content: keep-alive，在一个请求产生三次握手这种链接建立的时候，剩下的请求可以复用这个连接，不用每次都去建立连接

- 该版本可以并发请求，chrome 为例可以同时并发请求一个域 6 个请求，他这个响应机制是假设发出了 A，B两个并发请求，但是B有结果了也不会先返回，也会先按照顺序响应 A 的请求，然后按照顺序响应

### HTTP 2.0



